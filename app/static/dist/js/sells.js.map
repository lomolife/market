{"version":3,"names":[],"mappings":"","sources":["sells.js"],"sourcesContent":["/******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId])\n/******/ \t\t\treturn installedModules[moduleId].exports;\n\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\texports: {},\n/******/ \t\t\tid: moduleId,\n/******/ \t\t\tloaded: false\n/******/ \t\t};\n\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.loaded = true;\n\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n\n\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(0);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\n\tvar _content = __webpack_require__(1);\n\n\tvar content = _interopRequireWildcard(_content);\n\n\tfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\n\tdocument.addEventListener('DOMContentLoaded', function (event) {\n\t    var $ = function $(selectors) {\n\t        return document.querySelector(selectors);\n\t    };\n\t    // 请求用户的商品数据\n\t    var xhr = new XMLHttpRequest();\n\t    xhr.open('GET', '/market/api/goods/sells/' + openid);\n\t    xhr.onreadystatechange = function ready() {\n\t        if (xhr.readyState === 4 && xhr.status === 200) {\n\t            (function () {\n\t                var response = JSON.parse(xhr.responseText);\n\t                var goodHTML = \"\";\n\t                // 将获取的数据格式化并加入商品列表\n\t                response.goods.forEach(function (good, index) {\n\t                    goodHTML += content.generateGood(good, response.owner);\n\t                });\n\t                $('.goods').innerHTML = goodHTML;\n\t            })();\n\t        }\n\t    };\n\t    xhr.send();\n\t    // 为商品提供点击事件\n\t    $('.goods').addEventListener('click', function (event) {\n\t        // 阻止默认事件\n\t        event.preventDefault();\n\t        // 获取事件元素的临近 a 标签\n\t        if (event.target.className === 'good-link') {\n\t            (function () {\n\t                var goodElement = event.target;\n\t                // 获取点击对象的链接\n\t                var link = event.target.getAttribute('href');\n\t                // 处理链接，并获取 openid 和 goodid\n\t                var linkArr = link.split('/');\n\t                var openid = linkArr[4];\n\t                var goodid = linkArr[5];\n\t                // 显示actionsheet\n\t                $('#mask').style.display = 'block';\n\t                $('#mask').className = 'weui_mask_transition weui_fade_toggle';\n\t                $('#weui_actionsheet').className = 'weui_actionsheet weui_actionsheet_toggle';\n\t                // 绑定进入商品，编辑，售出等点击事件\n\t                $('#weui_actionsheet').addEventListener('click', function (event) {\n\t                    if (event.target.innerText === '进入商品') {\n\t                        // 则进入商品网址\n\t                        location.href = '/market/user/good/' + openid + '/' + goodid;\n\t                    }\n\t                    if (event.target.innerText === '编辑') {\n\t                        // 则进入编辑页面\n\t                        location.href = '/market/user/push/edit/' + openid + '/' + goodid;\n\t                    }\n\t                    if (event.target.innerText === '售出') {\n\t                        // 显示确定窗口\n\t                        $('#goo-report').style.display = 'block';\n\t                        // 出售确定窗口事件\n\t                        $('#goo-report-cancel').addEventListener('click', function (event) {\n\t                            $('#goo-report').style.display = 'none';\n\t                        });\n\t                        $('#goo-report-confirm').addEventListener('click', function (event) {\n\t                            // 执行出售操作，Ajax\n\t                            var xhr = new XMLHttpRequest();\n\t                            xhr.open('DELETE', '/market/api/good/' + openid + '/' + goodid);\n\t                            xhr.onreadystatechange = function () {\n\t                                if (xhr.readyState === 4 && xhr.status === 200) {\n\t                                    // 显示已完成的弹窗\n\t                                    $('#goo-report').style.display = 'none';\n\t                                    $('#toast').style.display = 'block';\n\t                                    setTimeout(function () {\n\t                                        $('#toast').style.display = 'none';\n\t                                    }, 2000);\n\t                                    // 删除节点\n\t                                    goodElement.parentNode.parentNode.removeChild(goodElement.parentNode);\n\t                                    $('#mask').style.display = 'none';\n\t                                    $('#mask').className = 'weui_mask_transition';\n\t                                }\n\t                            };\n\t                            xhr.send();\n\t                        });\n\t                    }\n\t                    if (event.target.innerText === '取消') {\n\t                        $('#mask').style.display = 'none';\n\t                        $('#mask').className = 'weui_mask_transition';\n\t                        $('#weui_actionsheet').className = 'weui_actionsheet';\n\t                    }\n\t                });\n\t            })();\n\t        }\n\t    });\n\t});\n\n/***/ },\n/* 1 */\n/***/ function(module, exports) {\n\n\t'use strict';\n\n\tObject.defineProperty(exports, \"__esModule\", {\n\t    value: true\n\t});\n\texports.generateGood = generateGood;\n\t// 用 JS 代码来生成 HTML 的内容，参数是商品对象，用户信息对象， 返回HTML字符串\n\tfunction generateGood(message, owner) {\n\t    var sexHTML = void 0;\n\t    function tagsToHTML(tags) {\n\t        var response = '';\n\t        tags.forEach(function (element, index) {\n\t            response += '<label class=\"ui-label\">' + element + '</label>';\n\t        });\n\t        return response;\n\t    }\n\t    if (owner.sex == 1) {\n\t        sexHTML = '<i class=\"ui-icon-male\"></i>';\n\t    } else {\n\t        sexHTML = '<i class=\"ui-icon-female\"></i>';\n\t    }\n\t    var response = '\\n            <li class=\"ui-whitespace good\">\\n                <div class=\"ui-border-t good-tag\">\\n                    ' + tagsToHTML(message.tags) + '\\n                </div>\\n                <a href=\"/market/user/good/' + owner.openid + '/' + message.id + '\" class=\"good-link\">\\n                    <div class=\"ui-row-flex\">\\n                        <div class=\"ui-col\">\\n                            <img class=\"good-banner\" src=\"' + message.picture[0] + '\" alt=\"首图\">\\n                        </div>\\n                        <div class=\"ui-col ui-col-2 ui-row-flex ui-row-flex-ver good-content\">\\n                            <div class=\"ui-col-2\">\\n                                <h1 class=\"ui-nowrap-multi ui-flex-pack-start ui-col-3 good-topic\">' + message.describe + '</h1>\\n                            </div>\\n                            <h2 class=\"ui-col good-price\">¥' + message.price + '<i class=\"good-cost\">¥' + message.cost + '</i></h2>\\n                        </div>\\n                    </div>\\n                    <ul class=\"ui-justify-flex good-message\">\\n                        <li>\\n                            <div class=\"ui-row-flex\">\\n                                <img class=\"ui-avatar\" src=\"' + owner.headimgurl + '\"></img>\\n                                <div class=\"good-message-owner\">\\n                                    <div class=\"ui-flex ui-flex-align-start\">\\n                                        <span>' + owner.nickname + sexHTML + '</span>\\n                                    </div>\\n                                    <div class=\"ui-flex ui-flex-align-end\">\\n                                        <span class=\"ui-txt-info\">' + message.date + '</span>\\n                                    </div>\\n                                </div>\\n                            </div>\\n                        </li>\\n                        <li>\\n                            <div class=\"ui-row-flex\">\\n                                <i class=\"ui-icon-pin ui-txt-info\"></i>\\n                                <span class=\"ui-flex ui-flex-align-center ui-txt-info\">' + message.address + '</span>\\n                            </div>\\n                        </li>\\n                    </ul>\\n                </a>\\n            </li>';\n\n\t    return response;\n\t}\n\n/***/ }\n/******/ ]);"],"file":"sells.js"}